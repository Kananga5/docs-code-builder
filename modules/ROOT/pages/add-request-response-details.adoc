= Add Request and Response Details

include::reuse::partial$beta-banner.adoc[tag="anypoint-code-builder",width=600]

//LOGO (web, desktop, or both)
include::partial$acb-ide-logos.adoc[tags="both-ides",width=600]

Continue work in xref:design-api-specification-from-scratch.adoc[] by defining request and response specifications. 

== Add Fragments from Exchange to Your Project

Add fragments to the project directory so that you can include them in your specification.

* *Training: American Flight Data Type* fragment for an object that corresponds to the definition of a flight
* *Training: American Flights Example* fragment for data that the flights API returns

To add the fragments: 

. In Anypoint Code Builder, open `american-flights-api.raml`.
. Open the Command Palette by pressing Ctrl+Shift+p (Windows) or Cmd+Shift+p (Mac), and provide this command:
+
[source,command]
----
MuleSoft: Add fragment dependency from Exchange
----
. Provide the name of the asset to add:
+
[source,command]
----
Training: American Flight Data Type
----
. Select the latest version of the asset.
+
When the process is complete, check for the `AmericanFlightsExample.raml` asset in your project's `/exchange_modules` directory. For example: 
+
----
exchange_modules/68ef9520-24e9-4cf2-b2f5-620025690913/training-american-flights-example/1.0.1/AmericanFlightsExample.raml
----
. From the Command Palette, add a fragment:
+
[source,command]
----
MuleSoft: Add fragment dependency from Exchange
----
. Provide the name of the asset to add:
+
[source,command]
----
Training: American Flights Example
----
. Select the latest version of the *American Flights Example* asset.
+
When the process is complete, check for the `AmericanFlightsExample.raml` asset in your project's `/exchange_modules` directory. For example: 
+
----
exchange_modules/68ef9520-24e9-4cf2-b2f5-620025690913/training-american-flight-data-type/1.0.1/AmericanFlightDataType.raml
----

== Include the Fragments in the Specification

Use `!include` directives to add the fragments to the specification:

* The `AmericanFlight` data type is defined in `AmericanFlightDataType.raml` 
* The `AmericanFlightsExample.raml` example is for a `200` response to the `get` request

To include the fragments: 

. Open *american-flight-api.raml* in the editor tab.
. Replace the existing content with this content:
+
[source,RAML]
--
#%RAML 1.0
title: American Flights API

types:
  AmericanFlight: !include exchange_modules/68ef9520-24e9-4cf2-b2f5-620025690913/training-american-flight-data-type/1.0.1/AmericanFlightDataType.raml //<1>

/flights:
  get:
    queryParameters:
      destination:
        required: false
        enum:
          - SFO
          - LAX
          - CLE
    responses:
      200:
        body:
          application/json:
            type: AmericanFlight[]
            examples:
              output: !include exchange_modules/68ef9520-24e9-4cf2-b2f5-620025690913/training-american-flights-example/1.0.1/AmericanFlightsExample.raml //<2>

  post:

  /{ID}:
    get:
--

. Includes `AmericanFlightDataType.raml` from Exchange
. Includes `AmericanFlightsExample.raml` from Exchange

== Create and Include an Example for the Post Response

Create an example for the post response, and include it in the specification. 

. In the Explorer, right-click on an empty space, and create a folder named `examples`.
+
image::add-new-folder.png[alt="New Folder option highlighted in the context menu",width=600]
. Right-click your `examples` folder, and create a new file named `AmericanFlightExample.raml`.
+
image::create-american-fligh-example-file.png[alt="AmericanFlightExample.raml file highlighted",width=600]
. Open the file, and add the following example:
+
[source,raml]
--
#%RAML 1.0 NamedExample
value:
    ID: 1
    code: ER38sd
    price: 400
    departureDate: 2017/07/26
    origin: CLE
    destination: SFO
    emptySeats: 0
    plane:
      type: Boeing 737
      totalSeats: 150
--
. Return to your `american-flights-api.raml` file, and create a set of elements under `/{ID}/get` for responses:
+
[source,raml]
--
#%RAML 1.0
title: American Flights API

types:
  AmericanFlight: !include exchange_modules/68ef9520-24e9-4cf2-b2f5-620025690913/training-american-flight-data-type/1.0.1/AmericanFlightDataType.raml

/flights:
  get:
    queryParameters:
      destination:
        required: false
        enum:
          - SFO
          - LAX
          - CLE
    responses:
      200:
        body:
          application/json:
            type: AmericanFlight[]
  post:

  /{ID}:
    get:
      body:
        application/json:
          type: AmericanFlight
          examples:
            output: !include examples/AmericanFlightExample.raml //<1>
--
+
[calloutlist]
. New example defined in your `examples` folder.

== Define a Request Example

// hn: do we need to reiterate which file we're working in now that there are two?

Similar to defining a response for a method, you can define a request example:

. Specify that a request to the `/flights:post` method requires an `AmericanFlight` object:
+
[source,raml,linenums]
--
#%RAML 1.0
title: American Flights API

types:
  AmericanFlight: !include exchange_modules/68ef9520-24e9-4cf2-b2f5-620025690913/training-american-flight-data-type/1.0.1/AmericanFlightDataType.raml

/flights:
  get:
    queryParameters:
      destination:
        required: false
        enum:
          - SFO
          - LAX
          - CLE
    responses:
      200:
        body:
          application/json:
            type: AmericanFlight[]
  post:
    body:
      application/json:
        type: AmericanFlight //<1>

  /{ID}:
    get:
      body:
        application/json:
          type: AmericanFlight
          examples:
            output: !include examples/AmericanFlightExample.raml
--
[calloutlist]
.. `AmericanFlight` is defined as the type for the `post` method.
. Under your `examples` folder, create a new example file named `AmericanFlightNoIDExample.raml`.
. Add the following information to your example file:
+
[source,raml,linenums]
--
#%RAML 1.0 NamedExample
value:
    code: ER38sd
    price: 400
    departureDate: 2017/07/26
    origin: CLE
    destination: SFO
    emptySeats: 0
    plane:
      type: Boeing 737
      totalSeats: 150
--
+
Notice that the ID parameter is missing since you don't have the flight ID when creating a new flight record.


. Add the examples to your specification, and include a custom message:
+
[source,RAML]
----
#%RAML 1.0
title: American Flights API

types:
  AmericanFlight:

/flights:
  get:
    queryParameters: //for selecting a destinatiON
      destination:
        required: false
        enum:
          - SFO
          - LAX
          - CLE
    responses:
      200:
        body:
          application/json:
            type: AmericanFlight[]
  post:
    body:
      application/json:
        type: AmericanFlight
        examples:
          input: !include examples/AmericanFlightExample.raml  //included example
    responses:
      201:
        body:
          application/json:  //required format
          example:
            message: Flight added (but not really) //custom message for 201 response

  /{ID}:
    get:
      body:
        application/json:
          type: AmericanFlight
          examples:
            output: !include examples/AmericanFlightExample.raml //included example
----

. Proceed to xref:test-api-specification.adoc[] to test the API endpoints.
