= Add Request and Response Details

include::reuse::partial$beta-banner.adoc[tag="anypoint-code-builder"]

You can define request and response details for your API specification.


== Before You Begin

Before getting started, ensure you:

* Set up your MuleSoft environment. +
See xref:setup.adoc[] for more information.
* Created a basic structure for your API specification. +
See xref:design-api-specification.adoc[].

== Add Data Types and Example Fragments from Exchange

. In Anypoint Code Builder, open your `american-flights-api.raml` file.
. Open the Command Palette (`ctrl/cmd + shift + P`) and type _MuleSoft: Add fragment dependency from Exchange_.
+
image::add-fragment-from-exchange.png["MuleSoft: Add fragment dependency from Exchange option highlighted"]
. Add the `Training: American Flight Data Type` asset.
+
image::add-training-american-flight.png["Training: American Flight Data Type asset option highlighted"]
. Select the latest version of the `American Flight Data Type` asset.
+
image::add-flight-data-type-version.png["Latest American Flight Data Type asset version highlighted"]
+
The status bar shows a *Dependencies successfully added* message.
. Open the Command Palette (`ctrl/cmd + shift + P`) and type _MuleSoft: Add fragment dependency from Exchange_.
+
image::add-fragment-from-exchange.png["MuleSoft: Add fragment dependency from Exchange option highlighted"]
. Add the `Training: American Flights Example` asset.
+
image::add-training-example.png["Training: American Flights Example asset option highlighted"]
. Select the latest version of the `American Flights Example` asset.
+
image::add-training-example-version.png["Latest version of the American Flights Example asset highlighted"]
+
The status bar shows a *Dependencies successfully added* message.
+
In the Package Explorer, you can see both API fragments that you imported:
* *AmericanFlightDataType.raml* defines an object corresponding to the definition of a flight.
* *AmericanFlightsExample.raml* defines the example of data that the flights API returns.
+
//TO-DO: Take a SS in a lower resolution, or only a part of the screen. Hi-res SS are hard to read in a 13 inch display.
image::imported-assets.png["AmericanFlightDataType.raml and AmericanFlightsExample.raml files highlighted in the Package Explorer"]

== Add Data Type to your API Specification

Use your imported fragments as types for your API specification:

. Open the *american-flight-api.raml* file in the editor tab.
. Before the `/flights` resource, add a `types` element, go to a new line and press `tab` to add an indentation
. Add a type named `AmericanFlight:`:
+
[source,RAML]
--
#%RAML 1.0
title: American Flights API

types:
  AmericanFlight:

/flights:
  get:
    queryParameters:
      destination:
        required: false
        enum:
          - SFO
          - LAX
          - CLE
  post:

  /{ID}:
    get:
--
// If using a Mac, try `fn + ctrl + spacebar`.

// hn: idea - just show what to add to the code and what the yaml file looks like after.
. Add an `!include` directive and press `ctrl + spacebar` to bring up the autocomplete options.
. Select `AmericanFlightsDataType.raml`.
+
[source,RAML]
--
#%RAML 1.0
title: American Flights API

types:
  AmericanFlight: !include exchange_modules/68ef9520-24e9-4cf2-b2f5-620025690913/training-american-flight-data-type/1.0.1/AmericanFlightDataType.raml

/flights:
  get:
    queryParameters:
      destination:
        required: false
        enum:
          - SFO
          - LAX
          - CLE
  post:

  /{ID}:
    get:
--
. Inside the `get:` method of your `/flights` resource, add a new child element `responses` at the same level as `queryParameters`.
+
. Press `ctrl + spacebar` to bring up the autocomplete options, and add the elements:
* `200`
* `body`
* `application/json`
* `type`
. For the `type` element, press `ctrl + spacebar` and select the `AmericanFlight` type.
. Add `[]` at the end of your `AmericanFlight` type to define it as an array.
+
[source,RAML]
--
#%RAML 1.0
title: American Flights API

types:
  AmericanFlight: !include exchange_modules/68ef9520-24e9-4cf2-b2f5-620025690913/training-american-flight-data-type/1.0.1/AmericanFlightDataType.raml

/flights:
  get:
    queryParameters:
      destination:
        required: false
        enum:
          - SFO
          - LAX
          - CLE
    responses:
      200:
        body:
          application/json:
            type: AmericanFlight[]
  post:

  /{ID}:
    get:
--

== Add an Example Response

Create a new `examples:` element for the `responses` element for your `/flights` resource:

. Add a new resource at the same level as your `type` response, press `ctrl/cmd + spacebar` to bring up the autocomplete options, and select `examples`.
// hn: This automatically adds the colon and indents the next line so indention not necessary
. Under examples, add an indentation, press `ctrl + spacebar`, and select *output*.
// hn: It doesn't add the colon - is it necessary?
. Add an `!include` directive and press `ctrl + spacebar` to bring up the autocomplete options.
// You have to select examples or exchange_modules before you can select the raml...
. Select `AmericanFlightExample.raml` as the reference for your example.
// hn: my options don't include the .raml. When I include, I get an error that it doesn't exist. It works if I add "examples" in the path.
// hn: I think there's a bug.
+
[source,RAML]
--
/flights:
  get:
    queryParameters:
      destination:
        required: false
        enum:
          - SFO
          - LAX
          - CLE
    responses:
      200:
        body:
          application/json:
            type: AmericanFlight[]
            examples:
              output: !include exchange_modules/68ef9520-24e9-4cf2-b2f5-620025690913/training-american-flights-example/1.0.1/AmericanFlightsExample.raml

--

== Define a Response in a New Folder

You can define your responses in a folder within your project:

. In the Package Explorer, right-click on an empty space, and select *New Folder*.
+
image::add-new-folder.png["New Folder option highlighted in the context menu"]
. Name the new folder *examples*.
+
image::create-examples-folder.png["New examples folder highlighted"]
. Right-click on your *examples* folder, select *New File*, and create a new file named `AmericanFlightExample.raml`.
+
image::add-new-file.png["New file highlighted in the context menu"]
+
image::create-american-fligh-example-file.png["AmericanFlightExample.raml file highlighted"]
// hn: this is how we should do it!
. Open the file and add the following example:
+
[source,raml,linenums]
--
#%RAML 1.0 NamedExample
value:
    ID: 1
    code: ER38sd
    price: 400
    departureDate: 2017/07/26
    origin: CLE
    destination: SFO
    emptySeats: 0
    plane:
      type: Boeing 737
      totalSeats: 150
--
. Go back to your *american-flights-api.raml* file.
. Create a new set of elements for response under your `/{ID}/get` resource:
+
[source,raml,linenums]
--
#%RAML 1.0
title: American Flights API

types:
  AmericanFlight: !include exchange_modules/68ef9520-24e9-4cf2-b2f5-620025690913/training-american-flight-data-type/1.0.1/AmericanFlightDataType.raml

/flights:
  get:
    queryParameters:
      destination:
        required: false
        enum:
          - SFO
          - LAX
          - CLE
    responses:
      200:
        body:
          application/json:
            type: AmericanFlight[]
  post:

  /{ID}:
    get:
      body:
        application/json:
          type: AmericanFlight
          examples:
            output: !include examples/AmericanFlightExample.raml //<1>
--
+
[calloutlist]
.. New example defined in your `examples` folder.

== Define a Request Example

// hn: do we need to reiterate which file we're working in now that there are two?

Similar to defining a response for a method, you can define a request example:

. Specify that a request to the `/flights:post` method requires an `AmericanFlight` object:
+
[source,raml,linenums]
--
#%RAML 1.0
title: American Flights API

types:
  AmericanFlight: !include exchange_modules/68ef9520-24e9-4cf2-b2f5-620025690913/training-american-flight-data-type/1.0.1/AmericanFlightDataType.raml

/flights:
  get:
    queryParameters:
      destination:
        required: false
        enum:
          - SFO
          - LAX
          - CLE
    responses:
      200:
        body:
          application/json:
            type: AmericanFlight[]
  post:
    body:
      application/json:
        type: AmericanFlight //<1>

  /{ID}:
    get:
      body:
        application/json:
          type: AmericanFlight
          examples:
            output: !include examples/AmericanFlightExample.raml
--
[calloutlist]
.. `AmericanFlight` is defined as the type for the `post` method.
. Under your `examples` folder, create a new example file named `AmericanFlightNoIDExample.raml`.
. Add the following information to your example file:
+
[source,raml,linenums]
--
#%RAML 1.0 NamedExample
value:
    code: ER38sd
    price: 400
    departureDate: 2017/07/26
    origin: CLE
    destination: SFO
    emptySeats: 0
    plane:
      type: Boeing 737
      totalSeats: 150
--
+
Notice that the ID parameter is missing since you don't have the flight ID when creating a new flight record.
. In your *american-flights-api.raml* file, define the response for your `post` method:
+
[source,raml,linenums]
--
#%RAML 1.0
title: American Flights API

types:
  AmericanFlight: !include exchange_modules/68ef9520-24e9-4cf2-b2f5-620025690913/training-american-flight-data-type/1.0.1/AmericanFlightDataType.raml

/flights:
  get:
    queryParameters:
      destination:
        required: false
        enum:
          - SFO
          - LAX
          - CLE
    responses:
      200:
        body:
          application/json:
            type: AmericanFlight[]
  post:
    body:
      application/json:
        type: AmericanFlight
        examples:
          input: !include examples/AmericanFlightNoIDExample.raml //<1>

  /{ID}:
    get:
      body:
        application/json:
          type: AmericanFlight
          examples:
            output: !include examples/AmericanFlightExample.raml
--
+
[calloutlist]
.. The last example defined in your `examples` folder.

Additionally, you can define the type of response of your `post` method for your `/flights` resource:

. Add a new line under your `/flights:post` method and indent it at the same level as your `body:` element.
// hn: there's something missing - need the responses element.
. Press `ctrl + spacebar` to bring up the autocomplete options to create a 201 response:
+
[source,raml,linenums]
--
#%RAML 1.0
title: American Flights API

types:
  AmericanFlight:

/flights:
  get:
    queryParameters:
      destination:
        required: false
        enum:
          - SFO
          - LAX
          - CLE
    responses:
      200:
        body:
          application/json:
            type: AmericanFlight[]
  post:
    body:
      application/json:
        type: AmericanFlight
        examples:
          input: !include examples/AmericanFlightExample.raml
    responses:
      201: //<1>
        body:
          application/json:
            example:

  /{ID}:
    get:
      body:
        application/json:
          type: AmericanFlight
          examples:
            output: !include examples/AmericanFlightExample.raml
--
+
[calloutlist]
.. Create a 201 response with the required `body` > `application/json` > `example` elements.
. As an example, define a custom message: *Flight added (but not really)*:
+
[source,raml,linenums]
--
responses:
  201:
    body:
      application/json:
        example:
          message: Flight added (but not really)
--

== Next Step

* xref:test-api-specification.adoc[Test an API Specification Using Mocking Service]. +
Discover API Console and test the endpoints of the API that you designed using the mocking service embedded with Anypoint Code Builder.
