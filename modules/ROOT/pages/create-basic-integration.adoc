= Create an Integration for the American Flights Example
:page-aliases: tut-dev-create-basic-integration.adoc

include::reuse::partial$beta-banner.adoc[tag="anypoint-code-builder"]

//LOGO (web, desktop, or both)
include::partial$acb-ide-logos.adoc[tags="both-ides"]

Start by creating a basic integration for the American Flights example. This integration provides some of the logic for processing requests from the American Flights API.

== Before You Begin

* Complete xref:create-xml-snippets.adoc[].
* Install a REST client such as Postman or Advanced REST Client.

== Create a Mule Application

Start an integration application for the American Flights example. For more guidance, see xref:develop-integration.adoc#start-an-integration[Start an Integration].

. Open Anypoint Code Builder from the IDE.
. Select *Develop an Integration* from the *Quick Actions* menu.
. Configure your integration using the following values:
+
.. Under *Project Name*, type `american-ws-anypoint-code-builder`.
.. Under *Project Location*, select *Browse*, and then select your home directory.
+
. Select *Create Project*.

[[configure]]
== Configure an HTTP Listener Operation and Set a Payload

The listener is for triggering the flow, and Set Payload provides some test data for the integration.

. In Project Explorer, select the `american-ws-anypoint-code-builder.xml` file.
+
//dm: Add callouts to this image as described below. 
image::empty-canvas-state.png["american-ws-anypoint-code-builder.xml file shown in visual representation of its Mule flow and the Mule Configuration file"]
+
You see two different views:
+
[calloutlist]
.. The canvas UI provides space for a visual representation of your Mule flows or subflows.
.. The configuration XML editor displays the configuration file for your Mule application.
. Select *Flow* from the canvas to create an empty flow.
. In the configuration XML, replace the name of your flow with `getFlights`.
+
[%header,cols="1a,1a"]
|===
| Automatically Generated Flow Element | Renamed Flow Element

| 
[source, XML]
----
<flow name="name1" >
  
</flow>
----

|
[source, XML]
----
<flow name="getFlights" >
  
</flow>
----
|===
. Add the HTTP Listener component to your configuration XML:
.. In the UI canvas, after your *Flow* component, select the `plus` icon:
+
image::main-tutorial-add-first-http-listener.png["Plus icon highlighted in the flow"]
.. Search for and select *Listener* from the *HTTP* results:
+
image::main-tutorial-add-first-listener.png["Listener component highlighted in the Add Component section"]
+
The configuration XML file adds the XML for the HTTP Listener into the `<flow/>` element. For example:
+
[source,XML]
----
<flow name="name1" >
  <http:listener path="" config-ref="" doc:name="Listener" doc:id="ojzfry" />
  
</flow>
----
. In the configuration XML, above the `<flow/>` element, add the `<http:listener-config/>` component: 
.. In the configuration XML, press Ctrl+Spacebar (Mac) or Cmd+Spacebar(Windows) to open the XML configuration menu.
.. Type `http`, and select the _snippet_ `muledx:http-listener-config`.
+
image::add-http-config-snippet.png["http:listener-config highlighted in the configuration XML menu]
+
.Snippet XML example:
[source,xml]
----
<http:listener-config name="httpListenerConfig" doc:name="Listener Config" doc:id="b5c62f-a84a3a">
  <http:listener-connection host="Host" port="Port"/>
</http:listener-config>
----
. Configure the attributes for the HTTP Listener operation `<http:listener/>` and `<http:listener-config/>`:
+
[source,xml]
----
<!--1-->
<http:listener-config name="inbound-request" doc:name="Listener Config" doc:id="b5c62f-a84a3a"> 
  <http:listener-connection host="0.0.0.0" port="8081"/>
</http:listener-config>

<flow name="getFlights">
<!--2-->   
    <http:listener path="flights" config-ref="inbound-request" doc:name="HTTP /flights" />
</flow>
----
[calloutlist]
.. In `<http:listener-config/>` and its child element `<http:listener-connection/>`, set the attributes to values provided in the example. The `doc:id` is randomly generated and does not require a change.
.. In `<http:listener/>`, set the attributes to the values provided in the example. 
. Notice the graphical representation of the HTTP Listener element in the UI canvas.
+
When you select any processor in the canvas, Anypoint Code Builder highlights its location within the configuration XML.
+
image::http-highlight-flow.png["HTTP listener highlighted in the flow and in the XML code"]
. From the UI canvas, add a Set Payload component below your HTTP Listener operation, and configure its attributes in the configuration XML:
+
[source,xml,linenums]
----
<http:listener-config name="inbound-request" doc:id="b5c62f-a84a3a">
    <http:listener-connection host="0.0.0.0" port="8081" />
</http:listener-config>
  
<flow name="getFlights" >
  <http:listener path="" config-ref="inbound-request" doc:name="HTTP /flights" doc:id="htprur" />
  <set-payload value="Flight info" doc:name="Set Response" doc:id="e43e98-1a9a01"/>
</flow>
----

[[run]]
== Run Your Application in Debug Mode

. Open the *RUN AND DEBUG* panel by pressing Ctrl+Shift+d (Windows) or Cmd+Shift+d (Mac).
. Click the triangle icon in the panel to select *Debug Mule Application*. 
+
Anypoint Code Builder moves to the Run and Debug view, uses Maven to build your Mule application, and then deploys it to the embedded Mule runtime engine.
+
Using *Run* > *Start without Debugging* produces an error.
. Monitor the build process from the terminal:

* In the desktop IDE, select *View* > *Terminal*.
* In the web IDE, click the File menu icon before selecting *View* > *Terminal*

[source, terminal]
----
*******************************************************************************
* - -  + APPLICATION + - -   *   - - + DOMAIN + - -      * - - + STATUS + - - *
*******************************************************************************
* american-ws-anypoint-code-builder-1.0.0-SNAPS * default   * DEPLOYED        *
*******************************************************************************
----
. Test the connection from the configuration XML by clicking *Test Connection*, located above the global `<http:listener-config/>` component for the HTTP Listener connection. 
+
The UI provides status:

* *Verifying connection inbound-request*
* A successful connection:
+
*Connection is valid* 
* Potential error for `port 8081: Address already in use`: 
+
*Invalid Connection Got status code: 500 when trying to resolve a Mule Runtime operation* 
+
To address this error, configure a different port, such as `8082`, and re-run the application.

== Test Your Application

Use your REST client or a browser to trigger the flow: 

* In the desktop IDE, submit this URI:
+
[source,URI]
----

----

Make a `GET` request to `+https://<web-IDE-instance>/proxy/8081/flights+`. 
+

For web IDE instructions, see xref:ping-locally-deployed-app.adoc[] for more information about sending a request to your application.
+
Notice that the *Flight info* message is displayed as the response.

== Stop Your Application

. In Anypoint Code Builder, select the stop icon from the toolbar.
+
image::stop-mule-application.png["Stop icon highlighted in the toolbar"]
. Anypoint Code Builder returns to the Explorer view.

== Next Step

* xref:connect-to-a-db.adoc[Connect to a Database]. +
Import a connector from Exchange and configure it to connect to an existing database that returns real information about flights for your API.
