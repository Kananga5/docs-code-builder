= Viewing DataWeave Problems

include::reuse::partial$beta-banner.adoc[tag="anypoint-code-builder"] 

//LOGO (web, desktop, or both)
include::partial$acb-ide-logos.adoc[tags="both-ides"]

When a DataWeave expression or script in your configuration XML has an issue, the syntax highlighting in the configuration XML for your application indicates that there is a problem. A problem can consist of one or more issues. 

To view the problem in the configuration XML:

. Mouse over the highlighted area of the DataWeave code to open a list of issues.
. Scroll to the end of the list of issues, and click *View Problem*
+
image::acb-dw-run-preview.png
+
A list of one or more issues opens for you to examine the issues. The following list has 14 issues that you can navigate through and close when done:

. After viewing the issues, fix them manually or perform a *Quick Fix*.
+
See <<quick-fix>>.


Optionally, use *Run Preview* to discover how the script or expression runs with your fix:

To launch the *Run Preview* menu, click the fixed expression or script until a lightbulb icon appears, and then press Cmd+. (Cmd key followed by a period). 

image::acb-run-preview.png


[[quick-fix]]
== Use DataWeave Quick Fix and Preview Features

To preview the result of your DataWeave transformation, use the *Run Preview* command from a DataWeave expression or script within the configuration XML for your integration application.

include::partial$dw-dependency-warning.adoc[]

Create a Mule application that receives an XML payload with dates using different date separators (`/`, `.`, and `-`).
The application uses a DataWeave script to normalize the dates to use a consistent separator (`-`):

. In Anypoint Code Builder, click *Develop an Integration*.
. Name your project `normalize-dates`.
. Specify your home directory for the location and click *Create Project*.
. Add the following HTTP Listener config and flow to your `normalize-dates.xml` file:
+
[source,XML]
--
<http:listener-config name="get-endpoint" doc:name="Listener config" >
    <http:listener-connection host="0.0.0.0" port="8081" />
</http:listener-config>

<flow name="main-flow" doc:name="Flow"  >
<http:listener path="/" config-ref="get-endpoint" doc:name="Listener"  />
<ee:transform doc:name="Transform" >
<ee:message>
        <ee:set-payload>
            <![CDATA[
            ]]>
        </ee:set-payload>
    </ee:message>
</ee:transform>
</flow>
--
. Within the `[CDATA[` code, add the following DataWeave script:
+
[source,dataweave]
--
%dw 2.0
output application/xml
fun normalize(date) = (date) replace "/" with "-" replace "." with "-"
---
dates: payload.dates mapObject ((date, index) ->
   date : normalize(date)
)
--
+
.Click to show the `normalize-dates-xml` file.
[%collapsible]
====
[source,XML]
<?xml version="1.0" encoding="UTF-8"?>
<mule xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
    xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
    xmlns:http="http://www.mulesoft.org/schema/mule/http"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
    http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
    http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd">
<http:listener-config name="get-endpoint" doc:name="Listener config" >
    <http:listener-connection host="0.0.0.0" port="8081" />
</http:listener-config>
<flow name="main-flow" doc:name="Flow"  >
<http:listener path="/" config-ref="get-endpoint" doc:name="Listener"  />
<ee:transform doc:name="Transform" >
<ee:message>
        <ee:set-payload>
            <![CDATA[
                %dw 2.0
                output application/xml
                fun normalize(date) = (date) replace "/" with "-" replace "." with "-"
                ---
                dates: payload.dates mapObject ((date, index) ->
                    date : normalize(date)
                )
            ]]>
        </ee:set-payload>
    </ee:message>
</ee:transform>
</flow>
</mule>
====
+
Anypoint Code Builder warns you that the payload cannot be resolved:
+
image::quick-fix-dw-example.png[]

. Select *Quick Fix* > *Create Sample Data for Payload* > *XML*.
. Replace the generated `payload.xml` file with the following XML code:
+
[source,XML]
--
<dates>
  <date>26-JUL-16</date>
  <date>27/JUL/16</date>
  <date>28.JUL.16</date>
</dates>
--
. Back in your `normalize-date.xml` file, locate your cursor within your DataWeave code, click *Show Code Actions*, and select *Run Preview*:
+
image::run-preview-dw-example.png[]

Note that the output tab shows the payload sample with the date separators normalized:

[source,XML]
--
<dates>
  <normalized_as_string>26-JUL-16</normalized_as_string>
  <normalized_as_string>27-JUL-16</normalized_as_string>
  <normalized_as_string>28-JUL-16</normalized_as_string>
</dates>
--
