= Debugging Mule Applications
:page-aliases: debug-add-breakpoint.adoc, debug-add-components.adoc, debug-run-debug-sessions.adoc, debug-a-mule-application.adoc


include::reuse::partial$beta-banner.adoc[tag="anypoint-code-builder"] 

//LOGO (web, desktop, or both)
include::partial$acb-ide-logos.adoc[tags="both-ides"]

// Combine with breakpoints, debug sessions

Debug your Mule application using the embedded debugger in Anypoint Code Builder. 


The process for debugging a Mule app is:

. Set breakpoints to pause the execution of a flow at lines that you want to inspect or fix.
+
Breakpoints are markers that you add on line numbers in a configuration XML file for a Mule application that you are developing.
. Start the debugger.
// .. Use the *Run and Debug* icon in the activity bar to open *Run and Debug* menu. 
// .. Click *Start Debugging (F5)* icon to start the debugger.
. Start execution of a flow in your Mule application.
+
For example, trigger an HTTP listener or configure a Scheduler component.
. When the execution stops at a breakpoint, inspect and fix issues.
. After addressing an issue at a breakpoint, redeploy (_hot deploy_) the running instance of your application.
+
See <<hot-deploy>>.
. Execute your flow again, and continue debugging until you address all issues. 



== Debug Console Overview 

image::debugger-view.png["Elements of the debugger view"]

[calloutlist]
. *Start Debugging*: Start an instance of a Mule application in debugging mode.
. *Debug Toolbar*: Use shortcuts to control debugging of Mule applications.
+
See <<debug-toolbar>>.
. *Variables* panel: Provides Mule event and parameter data. The Mule event includes message payload and attribute details, as well as Mule variable data. The parameters include component data, such as the component name.
. *Run and Debug* (MuleSoft) icon: Opens the *Run and Debug* panel, where you can click *Start Debugging* and find debugging information. Key command: Cmd+Shift+d (Mac) or Ctrl+Shift+d (Windows) 
. *Watch* panel: Helps you evaluate variables and expressions.
. *Call Stack* panel: Identifies the functions or procedures that are currently in the stack.
. *Breakpoints* panel: Lists all breakpoints in your Mule application.
. *Terminal* console: Displays the output of the Maven build process and the results of the deployment to the embedded Mule Runtime engine.
. *Breakpoint* icon: Identifies a line in the configuration XML to pause execution of the flow so that you can check for and fix any issues.


[[debug-toolbar]]
== Debug Toolbar

Use shortcuts to control debugging of Mule applications:
// retake this with the latest xml file, fix order of options.

image::debugger-toolbar.png["Debug Toolbar"]

[calloutlist]
. *Continue*: Proceed to the next breakpoint, if present, and pause execution of the application. Otherwise, continue to the end of the application. Key command: F5
. *Step Over*: Proceed to the next component in the flow, where execution pauses. At a Flow Ref component (`<flow-ref/>`), clicking *Step Over* proceeds to the next component in the flow but _does not_ follow the Flow Ref logic to a referenced flow or proceed to another flow. Key command: F10
+ 
See <<step-over>>.
. *Step Into*: Proceed to the next component in the flow, where execution pauses. At a Flow Ref component (`<flow-ref/>`), clicking *Step Into* follows the logic of the component and proceeds to the first component in the referenced flow. If a component in a flow follows a Flow Ref component, *Step Into* returns to that component after the last component in the referenced flow (or flows). Key command: F11
+
See <<step-into>>.
. *Step Out*: Exit the current flow and attempts to return to a previous flow. If a previous flow doesn't exist, the debugger behaves like *Continue*. Key command: Shift+F11
. *Restart*: Stop and restart the application without packaging new dependencies, such as new connector dependencies in your `pom.xml` file. Key command: Shift+Cmd+F5 (Mac) or Shift+Ctrl+F5 (Windows)
. *Stop*: Stop execution of the application. The next debugging session that you start packages the application with any new dependencies. Key command: Shift+F5

[[step-over]]
=== Step Over 

.Configuration XML example:
[source,xml]
----
<flow name="flow1" doc:name="Flow" >
  <http:listener path="greet" config-ref="HTTP_Listener_config" doc:name="Listener"/>
  <flow-ref name="myNewFlow" /> <!--1-->
  <logger doc:name="Logger1" message="test1"/> <!--2-->
</flow>

<flow name="flow2" doc:name="Flow" >
  <logger doc:name="Logger2" message="test2"/>
</flow>
----
.*Step Over* behavior:
[calloutlist]
. Skips `<flow-ref/>` logic
. Reaches `<logger/>` named `Logger1`

[[step-into]]
=== Step Into

.Configuration XML example:
[source,xml]
----
<flow name="flow1" doc:name="Flow" >
  <http:listener path="greet" config-ref="HTTP_Listener_config" doc:name="Listener"/>
  <flow-ref name="myNewFlow" /> <!--1-->
  <logger doc:name="Logger1" message="test1"/> <!--3-->
</flow>

<flow name="myNewFlow" doc:name="Flow" >
  <logger doc:name="Logger2" message="test2"/> <!--2-->
</flow>
----
.*Step Into* behavior:
[calloutlist]
. Enters `<flow-ref/>` to follow logic to `myNewFlow`
. Reaches `Logger2` in next flow, `myNewFlow`
. Returns to flow `flow1` to reach `Logger1`


== Add a Breakpoint

A breakpoint enables you to pause your Mule application at a specific place to learn more about what is happening.

To add a breakpoint to your Mule application:

. In Anypoint Code Builder, on the Explorer view, open your `interface.xml`.
. Select the *Run and Debug* icon in the activity bar:
+
image::run-and-debug.png[]
. Click the line number in your `<flow-ref>` component to add a breakpoint on that component.
+
image::add-breakpoint.png[]
+
NOTE: You can also use F9 to add a breakpoint to the current line.
. In your `implementation.xml` file, add two more breakpoints for the `<db:select>` and the `<set-variable>` components.

All breakpoints appear in the *Breakpoints* panel:

image::breakpoints-panel.png[]


== Start a Debug Session

After setting up your debug conditions, you can run a debug session and evaluate your Mule application at each breakpoint.

. In Anypoint Code Builder, on your Run and Debug view, click *Run and Debug*.
+
image::start-debugging.png[]
+
Anypoint Code Builder packages your application and opens a new terminal that deploys the application to the embedded Mule runtime engine:
+
image::packaged-and-running-terminals.png[]

== Test Your Mule Application

. Make a `GET` request to `+https://<web-IDE-instance>/proxy/8081/api/flights+`. +
See xref:ping-locally-deployed-app.adoc[] for more information about how to send requests to your application.
. In Anypoint Code Builder, notice that the application execution stopped at your first breakpoint.
+
image::debug-stop-at-flow-ref.png[]
. Click *Step Over* on your debug toolbar to move the execution to your next breakpoint.
+
In the Debug sidebar, the *Variables* panel shows details about the Mule event at that particular part of the flow.
+
image::debugger-stop-db-select.png[]
. Select the *Step Over* button on your debug toolbar to move the execution to your next breakpoint.
. In the Debug sidebar on the *Variables* panel, expand the *Mule Message* and the *Payload* variables and note that you can inspect the database response as an array.
+
image::debugger-stop-set-variable.png[]

== Add a Watch Expression

. In the Debug sidebar, in the Watch panel, select the `plus` icon.
+
image::debug-add-expression.png[]
. Add the expression `payload.^mediaType`.
. Select the *Step Over* button until your execution moves to the `<set-payload>` component.
+
Your payload is `application/java`.
. Click *Step Over*  until your execution jumps to the `<logger>` component.
+
Your payload is now `application/json`.
+
image::debuger-watch-expression-json.png[]
. Click *Continue* on your debug toolbar.
+
Note that the application returns the response from the database to your REST client.
+
.Response from the Database
[%collapsible]
====
[source,JSON]
--
[
    {
        "ID": 1,
        "code": "rree0001",
        "price": 541,
        "departureDate": "2016-01-20T00:00:00",
        "origin": "MUA",
        "destination": "LAX",
        "emptySeats": 0,
        "plane": {
            "type": "Boeing 787",
            "totalSeats": 200
        }
    },
    {
        "ID": 2,
        "code": "eefd0123",
        "price": 300,
        "departureDate": "2016-01-25T00:00:00",
        "origin": "MUA",
        "destination": "CLE",
        "emptySeats": 7,
        "plane": {
            "type": "Boeing 747",
            "totalSeats": 345
        }
    },
    {
        "ID": 3,
        "code": "ffee0192",
        "price": 300,
        "departureDate": "2016-01-20T00:00:00",
        "origin": "MUA",
        "destination": "LAX",
        "emptySeats": 0,
        "plane": {
            "type": "Boeing 777",
            "totalSeats": 300
        }
    },
    {
        "ID": 4,
        "code": "rree1000",
        "price": 200,
        "departureDate": "2016-01-20T00:00:00",
        "origin": "MUA",
        "destination": "CLE",
        "emptySeats": 5,
        "plane": {
            "type": "Boeing 737",
            "totalSeats": 150
        }
    },
    {
        "ID": 5,
        "code": "rree1093",
        "price": 142,
        "departureDate": "2016-02-11T00:00:00",
        "origin": "MUA",
        "destination": "SFO",
        "emptySeats": 1,
        "plane": {
            "type": "Boeing 737",
            "totalSeats": 150
        }
    },
    {
        "ID": 6,
        "code": "ffee1112",
        "price": 954,
        "departureDate": "2016-01-20T00:00:00",
        "origin": "MUA",
        "destination": "CLE",
        "emptySeats": 100,
        "plane": {
            "type": "Boeing 787",
            "totalSeats": 200
        }
    },
    {
        "ID": 7,
        "code": "eefd1994",
        "price": 676,
        "departureDate": "2016-01-01T00:00:00",
        "origin": "MUA",
        "destination": "SFO",
        "emptySeats": 0,
        "plane": {
            "type": "Boeing 777",
            "totalSeats": 300
        }
    },
    {
        "ID": 8,
        "code": "ffee2000",
        "price": 300,
        "departureDate": "2016-02-20T00:00:00",
        "origin": "MUA",
        "destination": "SFO",
        "emptySeats": 30,
        "plane": {
            "type": "Boeing 737",
            "totalSeats": 150
        }
    },
    {
        "ID": 9,
        "code": "eefd3000",
        "price": 900,
        "departureDate": "2016-02-01T00:00:00",
        "origin": "MUA",
        "destination": "SFO",
        "emptySeats": 0,
        "plane": {
            "type": "Boeing 737",
            "totalSeats": 150
        }
    },
    {
        "ID": 10,
        "code": "eefd4511",
        "price": 900,
        "departureDate": "2016-01-15T00:00:00",
        "origin": "MUA",
        "destination": "LAX",
        "emptySeats": 100,
        "plane": {
            "type": "Boeing 777",
            "totalSeats": 300
        }
    },
    {
        "ID": 11,
        "code": "rree4567",
        "price": 456,
        "departureDate": "2016-01-20T00:00:00",
        "origin": "MUA",
        "destination": "SFO",
        "emptySeats": 100,
        "plane": {
            "type": "Boeing 737",
            "totalSeats": 150
        }
    }
]
--
====

== Stop a Debug Session

To stop your debug session, click *Stop* on your debug toolbar.

image::debugger-stop.png[Stop button on the Debug Toolbar]



[[hot-deploy]]
== Hot Deploy When Debugging

Hot deploy as you debug your application. A hot deployment updates a running instance of your application but does not package new dependencies, such as new connector dependencies in your `pom.xml`:

. Ensure your Mule application is running in the IDE.
. Make an update to your application.
. Click the *Save and Hot-deploy to Mule Runtime* (lightning) icon to deploy the application with the change.
+
image::acb-hot-deploy.png["Hot-deploy (lightning) icon in a running Mule application"]

