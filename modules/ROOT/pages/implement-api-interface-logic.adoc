= Implementing the API Interface Logic

include::reuse::partial$beta-banner.adoc[tag="anypoint-code-builder"]

//LOGO (web, desktop, or both)
include::partial$acb-ide-logos.adoc[tags="both-ides"]

Provide the logic for flows in the American Flights API implementation.

== Before You Begin

xref:implement-api-specification.adoc[]

== Rename Your Mule Configuration Files

Identify the interface and implmentation files for your American Flights application. The interface receives all incoming requests to your application. The scaffolded flows in the interface validate and route requests. The implementation provides the backend logic for calls to the interface.

. Rename `american-flight-api-acb.xml` to `interface.xml` by right-clicking the file name, selecting *Rename*, and providing the new name. 
+
image::api-interface-rename.png["Rename option highlighted the context menu of american-flight-api-acb.xml file"]
. Rename `american-ws-anypoint-code-builder.xml` to `implementation.xml`.

== Remove HTTP Listener from the Implementation File

To handle requests through the HTTP endpoint in the interface, remove the HTTP listeners from `implementation.xml`.

. Open `implementation.xml`.
+ 
image::get-flights-select-listener.png["HTTP listener highlighted in the implementation.xml file"]
. Delete the *HTTP /flights* listener XML from the configuration XML:
+
[source,xml]
--
<http:listener path="flights" config-ref="inbound-request" doc:name="HTTP /flights" />
--
+
.Click for the resulting flow.
[collapsible]
====
[source,xml]
--
<flow name="getFlights">
    <db:select doc:name="Query Flights" doc:id="pvuqsc" config-ref="Database_Config" >
        <db:sql>
            <![CDATA[Select * FROM american]]>
        </db:sql>
    </db:select>

    <ee:transform doc:name="Transform Message" doc:id="uniqueId" >
        <ee:message >
            <ee:set-payload >
                <![CDATA[
                %dw 2.0
                output application/json
                ---
                payload map ( payload01 , indexOfPayload01 ) -> {
                  ID: payload01.ID,
                  code: (payload01.code1 default "") ++ (payload01.code2 default ""),
                  price: payload01.price default 0,
                  departureDate: payload01.takeOffDate as String default "",
                  origin: payload01.fromAirport default "",
                  destination: payload01.toAirport default "",
                  emptySeats: payload01.seatsAvailable default 0,
                  plane: {
                    "type": payload01.planeType default "",
                    totalSeats: payload01.totalSeats default 0
                  }
                }
                ]]>
            </ee:set-payload>
        </ee:message>
    </ee:transform>

</flow>
--
====

== Reference the Implementation Flow from the Interface File

. In Anypoint Code Builder, open your `interface.xml` file.
. Use the *Flow List* to navigate to your `get:\flights:american-flights-api-config` flow:
+
[source,xml]
--
<flow name="get:\flights:american-flights-api-config">
    <logger level="INFO" message="get:\flights:american-flights-api-config" />
</flow>
--
// TO-DO: The name of the file should be consistent with the name of the asset. For example, in my case, the file name is acb-american-flights-api-config.
+
image::select-get-flights-flow.png["`get:\flights:american-flights-api-config` flow highlighted]
// TO-DO: Replace current image with an image that can be seen in a 13 inch display.
. Select the `plus` icon before the Transform Message component:
+
image::add-sub-flow-canvas-tutorial.png[]
. Configure the `name` attribute as `_getFlights_`.

Now all calls to `+https://<web-IDE-instance>/proxy/8081/api/flights+` are handled by your `interface` file and processed in your `implementation` file. +
See xref:ping-locally-deployed-app.adoc[] for more information about sending requests to your application.

== Next Step

* Learn how to xref:debug-a-mule-application.adoc[Debug a Mule Application].
