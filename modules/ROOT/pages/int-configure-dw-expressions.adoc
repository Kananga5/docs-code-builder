= Configuring DataWeave Expressions

Configure DataWeave expressions in your integrations and implementations from the expression builder UI or from the configuration XML. Mock data for your expressions so that you can preview sample output of your expressions in Anypoint Code Builder.

* <<expression-builder>>
* <<sample-data>>

//TODO: CONVERT TO INCLUDE FOR SHARING
DataWeave is the programming language designed by MuleSoft for data transformation within a Mule app. DataWeave is also the expression language Mule runtime engine uses to configure components and connectors. When you create an implementation or integration in Anypoint Code Builder, you are creating a Mule app that runs on an instance of the Mule runtime engine. 

//TODO_TODO BE SURE TO COVER ALL OF THESE IN SOME WAY:
// * When a user clicks on a field that accepts DataWeave - a side car should be opened to the left of the Component Configuration Panel.
// * Users should be able to either click on their data to insert it into the text area or begin typing to see a list of auto-complete options to choose from
// * Hovering over a datapill should show insights
// * Users should have the ability to minimize the sidecar by clicking on the following icon


== Before You Begin

It is important to have a basic understanding of the DataWeave language. DataWeave expressions accept the following: 

* xref:dataweave::dw-functions.adoc[DataWeave functions and operators] and data types that their parameters accept. For example, the concatenation function (xref:dataweave::dw-core-functions-plusplus.adoc[++]) accepts strings, arrays, objects, date-related data types, and so on. 
* xref:dataweave::dataweave-variables-context.adoc[Predefined Mule variables] such as `payload`, `attributes`, `vars`.
* xref:dataweave::dataweave-selectors.adoc[DataWeave selectors] for capturing the values of fields within the payload, attribute, or variable within the xref:mule-runtime::about-mule-event.adoc[Mule event]. 

For more information, see xref:dataweave::index.adoc[]. 

[[expression-builder]]
== Construct a DataWeave Expression from the Canvas UI

Use the DataWeave expression builder to ease configuration of DataWeave expressions, supply sample data for your expression, and preview the expression's output without the need to run your Mule app. 

The expression builder provides the following tabs:

* *Data*: Illustrates the data structure with any sample data that is available. For example:
+
image:int-dw-fx-data-tab.png["Data tab for expression field"]
+
The strings displayed as values for the payload and attributes, such as *"0"* and *"75"*, are not used for previewing or generating output.  
+
To create sample data from which you can preview the output of an expression, see <<sample-data>>.

* *Functions*: Lists all DataWeave functions from all xref:dataweave::dw-functions.adoc#dw_modules[DataWeave modules], such as String, Array, and Core modules. 
+
[%header,cols="1a,1a"]
|===
| DataWeave Functions
| Function Reference

| 
Hover over a function to get a short description:

image:int-dw-fx-functions-tab.png["Functions tab for expression field"]
|
Click *Details* to get complete documentation:

image:int-dw-fx-functions-tab-details.png["Data tab for expression field"]
|===

//TODO: within the fx field in the UI, you can also do Ctrl-space to get a list of Core functions only?

* *Preview*: 
+
TODO: ADD SCREENSHOT


To construct a DataWeave expression from the canvas:

. Create an integration project.
+
For guidance, see xref:int-create-integrations.adoc#create-integration-project[Create an Integration Project].
. From the canvas, add a Set Payload component.
+
Set Payload is convenient for demonstrating expression builder functionality. The expression builder is available to components with *fx* fields, which accept DataWeave expressions.
. Use the expression builder to start an expression:
.. Click Set Payload to display its configuration panel, and then click within its *Value* field (an *fx* field) to open the DataWeave expression builder.
+
Notice the *Data*, *Functions*, and *Preview* tabs in the expression builder.
+
TODO: ADD IMAGE
.. Click the *Functions* tab in the expression builder.
+
Notice the list of DataWeave modules, which includes Core and all other DataWeave modules. Each module contains a set of DataWeave functions. 
+
TODO: ADD IMAGE
+
//TODO: VERIFY
If you want to use a function in the Core module only, you can press Ctrl+Space (Mac) or Cmd+Space (Windows) in an empty *fx* field. If a value is already in the field, the list contains other context-specific data, such as a `default` setting or fields in the payload, for example. 
.. In the *Functions* tab, navigate to *Core* -> *++* (for concatenation).
+
Notice that you can hover over the function to get a short description of the function and that you can click *Details* to get full documentation of the function along with parameter descriptions and examples.
+
TODO: ADD IMAGES short description and full doc
.. Click `++` to add the function to *Value* field. 
. In Set Payload, use `++` to concatenate two strings. For example:
+
[source,DataWeave]
--
`"hello" ++ " world"`
--
.. In the expression builder, click *Preview* to view the output of the expression: `"hello world"`
+
TODO: ADD IMAGE
.. In the expression builder, click the *Data* field. 
+
TODO: SHOW WHAT IT SHOWS
. Use DataWeave selectors to construct an expression:

.. Replace the *Value* `"hello" ++ " world"` with the following complex JSON object:
+
[source,json]
--
{ "city" : { 
           "name" : "San Francisco",
           "address" : [{
                         "streetNumber": 10, 
                         "streetName": "Fremont Ave"
                      }, 
                      {
                         "streetNumber": 7, 
                         "streetName": "Decoto Way"
                     }]
         }, 
         "cityURL": "sf.org", 
         "phonenumber" : [
                         ["432-332-1112", "333-443-1325"], 
                         ["333-443-4421", "333-443-2211"]
                       ], 
                       "population": 100300, 
                       "popularSchools": ["St Charles", "JFK School"]
}
--
.. In the expression builder, click the *Data* field to display the structure of the JSON object with its preconfigured values. 
+
TODO: ADD IMAGE
.. In the canvas, add a Set Variable component after Set Payload.
+
TODO: ADD IMAGE
//TODO:VERIFY THAT THIS IS WHAT OCCURS
.. In the *Value* field, press Cmd+Space (Mac) or Ctrl+Space (Windows), and select `payload` from the resulting list.
.. Click the *Data* tab in the expression builder to display the structure of the payload.
+
TODO: ADD IMAGE
+
Notice that the structure of the payload matches the structure you set in Set Payload. 
.. In the *Value* field of Set Variable, type a dot (`.`) after `payload` (for example, `payload.`), press Cmd+Space (Mac) or Ctrl+Space (Windows), and select *city* from the list of available fields in the payload.
+
TODO: ADD IMAGE
+
The *Value* field now contains `payload.city`.
.. Click the *Preview* field for this value to view the the output.
+
[source,json]
--
{
  "name": "San Francisco",
  "address": [
    {
      "streetNumber": 10,
      "streetName": "Fremont Ave"
    },
    {
      "streetNumber": 7,
      "streetName": "Decoto Way"
    }
  ]
}
--

== Construct a DataWeave Expression from the XML

Use auto-complete menus from the XML to list DataWeave functions and TODO_TODO. 

In the XML, fields that accept DataWeave expressions begin with a hash and are surrounded by square brackets. For example: `#[payload]`, `#[payload.childfield.grandchildfield]`, `["hello" ++ "world"]`.

TODO_TODO

[[sample-data]]
== Provide Sample Data for a DataWeave Expression

Add sample data for Mule variables, such as `payload` in *fx* fields so that you can test and preview DataWeave expressions in your components locally, without running your application to retrieve Mule event data from an external source.

You can create sample data in the following formats:

* JSON
* XML
* CSV

To create sample data for a Mule variable:

. Hover over the Mule variable for which you want to provide sample data. For example:
+
TODO: ADD IMAGE
. Click *Quick Fix* to open the Quick Fix menu.
. Select *Create sample data for _your-value_*, such as *Create sample data for payload*.
. In the menu that opens, select a format for the sample data, such as JSON. 
+
image::dw-issue-sample-data-formats.png["Menu of Sample Data File Formats"]
+
The IDE creates a file for your sample data. For example:
+
TODO: ADD IMAGE
. Modify the default content in the file to create your own sample data in the selected format. For example:
+
TODO: ADD IMAGE
+
Hovering over the value now displays the type and structure of your sample data. 
+
TODO: ADD IMAGE 
. Preview your sample data from the expression builder UI:
.. From the canvas UI, click the component that contains your sample data. 
.. Click the field of the component that contains the sample data to open the expression builder for that field. For example:
+
TODO: ADD IMAGE 
.. In the expression builder, click *Data* to display your sample data within the data structure. For example: 
+
TODO: ADD IMAGE 
.. In the expression builder, click *Preview* to display the sample data. 
+
TODO: ADD IMAGE 

== See Also

* xref:int-debug-mule-apps.adoc[]
* xref:troubleshoot-dataweave.adoc[]
* xref:int-create-integrations.adoc#add-components[Add a Component to Your Project]

