= Iteratively Design an API Specification and Implement it

Anypoint Code Builder enables you to scaffold your API specification into a Mule project without having to publish it to Exchange. You can work on your Mule project, then edit the API specification, and re-scaffold it to reflect your new changes.

== Before You Begin

* Ensure you set up your MuleSoft environment. +
See xref:setup.adoc[] for more information.

== Create a New API Specification

To create a new API specification:

. In your web IDE instance, navigate to your Anypoint Code Builder view:
+
image::anypoint-code-builder-view.png[]
. Select *Design an API*.
+
image::design-api-1.png[]
+
. Configure your API using the following values:
+
image::design-api-ui-first.png[]
+
[calloutlist]
.. In *Project name*, type: `*Retrieve Users API*`.
.. In *Project Location*, select *Browse* and then select your home directory.
.. In *API Specification Language*, select *RAML 1.0*.
.. In *Business Group*, select the business group in which you want to create your API specification.
+
[IMPORTANT]
--
You can't change business groups after you create your API specification.
--
. Select *Create Project*.
+
The project explorer now shows you your American Flights API folder with an `american-flights-api.raml` file open in the editor.
// REUSE
. In the editor, add the following RAML specification:
+
[source,raml,linenums]
--
#%RAML 1.0
title: Retrieve User
version: 1.0.development
/users:
  get:
    description: Retrieve a list of all the users
    responses:
      200:
        body:
          application/json:
            example: |
              [{
              "id": 1,
              "name": "Leanne Graham",
              "username": "Bret",
              "email": "Sincere@april.biz",
              "address": {
                "street": "Kulas Light",
                "suite": "Apt. 556",
                "city": "Gwenborough",
                "zipcode": "92998-3874",
                "geo": {
                  "lat": "-37.3159",
                  "lng": "81.1496"
                }
              },
              "phone": "1-770-736-8031 x56442",
              "website": "hildegard.org",
              "company": {
                "name": "Romaguera-Crona",
                "catchPhrase": "Multi-layered client-server neural-net",
                "bs": "harness real-time e-markets"
              } }]
--

== Implement the Local API

By default, when you create a new API specification, Code Builder assigns it a version 1.0.0. You can create a multi-root workspace with your API specification directory and a new Mule project directory to design and implement the API iteratively:

. Open the Command Palette by pressing Ctrl+Shift+P (Windows) or Cmd+Shift+P (Mac) and provide the following command:
+
[source,command]
----
MuleSoft: Implement a Local API
----
. Code Builder creates a multi-root workspace to keep your API specification and Mule project in sync.
.. Choose a location to store your workspace. +
Your multi-root workspace is a `.code-workspace` file extension that keeps both of your directories coordinates.
+
[IMPORTANT]
--
Save your `.code-workspace` file in your home directory. Do not save it inside your API specification folder.
--
. After the workspace is created, Code Builder builds your API. +
In this step, Code Builder packages the API specification and publishes it to a local Maven repository as a snapshot.
. After building your API, Code Builder can now implement it locally:
.. Choose a project name for your Mule project: `_Retrieve Users Implementation_`.
.. Select your home directory as your target folder.
+
[TIP]
--
To see the progress of the full process:

. From the menu, select *View* > *Output*.
+
image::select-specific-output-view.png[]
. On the right top side of the output panel, select the drop-down menu.
+
image::select-output-dropdown.png[]
. Select *Mule DX Server*.
+
image::select-mule-dx-server.png[]
--

After Code Builder scaffolds your API specification, it opens a new directory in your newly created multi-root workspace with a Mule project. Note that it creates a flow with the proper APIkit router and another flow for the `GET` resource you designed in the RAML file:

[source,XML,linenums]
--
<flow name="get:\users:retrieve-users-api-config">
    <ee:transform doc:name="Transform Message">
        <ee:message>
            <ee:set-payload><![CDATA[%dw 2.0
output application/json
---
[
{
id: 1,
name: "Leanne Graham",
username: "Bret",
email: "Sincere@april.biz",
address: {
  street: "Kulas Light",
  suite: "Apt. 556",
  city: "Gwenborough",
  zipcode: "92998-3874",
  geo: {
    lat: "-37.3159",
    lng: "81.1496"
  }
},
phone: "1-770-736-8031 x56442",
website: "hildegard.org",
company: {
  name: "Romaguera-Crona",
  catchPhrase: "Multi-layered client-server neural-net",
  bs: "harness real-time e-markets"
}
}
]]]></ee:set-payload>
        </ee:message>
    </ee:transform>
</flow>
--

== Update the API Specification

. Navigate back to the `retrieve-users-api.raml` file under the *Retrieve Users API* directory.
+
[TIP]
--
To get a full picture of your API you can arrange the tabs to have the RAML editor, the XML configuration file editor, and the canvas one next to the other.
--
. Add a new `/userbyid` endpoint to your RAML file:
+
[source,raml,linenums]
--
#%RAML 1.0
title: Retrieve User
version: 1.0.development
/users:
  get:
    description: Retrieve a list of all the users
    responses:
      200:
        body:
          application/json:
            example: |
              [{
              "id": 1,
              "name": "Leanne Graham",
              "username": "Bret",
              "email": "Sincere@april.biz",
              "address": {
                "street": "Kulas Light",
                "suite": "Apt. 556",
                "city": "Gwenborough",
                "zipcode": "92998-3874",
                "geo": {
                  "lat": "-37.3159",
                  "lng": "81.1496"
                }
              },
              "phone": "1-770-736-8031 x56442",
              "website": "hildegard.org",
              "company": {
                "name": "Romaguera-Crona",
                "catchPhrase": "Multi-layered client-server neural-net",
                "bs": "harness real-time e-markets"
              } }]
  /userbyid:
    get:
      description: Get information about a particular user
      queryParameters:
        id:
          description: Specify the id of the user you want to retrieve
          type:        integer
          required:    false
          example: 3
      responses:
        200:
          body:
            application/json:
              example: |
                [{
                "id": 3,
                "name": "Clementine Bauch",
                "username": "Samantha",
                "email": "Nathan@yesenia.net",
                "address": {
                  "street": "Douglas Extension",
                  "suite": "Suite 847",
                  "city": "McKenziehaven",
                  "zipcode": "59590-4157",
                  "geo": {
                    "lat": "-68.6102",
                    "lng": "-47.0653"
                  }
                },
                "phone": "1-463-123-4447",
                "website": "ramiro.info",
                "company": {
                  "name": "Romaguera-Jacobson",
                  "catchPhrase": "Face to face bifurcated interface",
                  "bs": "e-enable strategic applications"
                } }]
--

== Re-Scaffold the API Specification

With a new endpoint added to your API specification, you can now re-scaffold it to update your linked Mule project:

. Navigate back to the `retrieve-users-api.raml` file under the *Retrieve Users API* directory.
. Open the Command Palette by pressing Ctrl+Shift+P (Windows) or Cmd+Shift+P (Mac) and type _MuleSoft: Re-Scaffold this local API_.
. Note that Code Builder adds a new flow for the newly added endpoint:
+
[source,XML,linenums]
--
<flow name="get:\users:retrieve-users-api-config">
    <ee:transform doc:name="Transform Message">
        <ee:message>
            <ee:set-payload><![CDATA[%dw 2.0
output application/json
---
[
{
id: 1,
name: "Leanne Graham",
username: "Bret",
email: "Sincere@april.biz",
address: {
  street: "Kulas Light",
  suite: "Apt. 556",
  city: "Gwenborough",
  zipcode: "92998-3874",
  geo: {
    lat: "-37.3159",
    lng: "81.1496"
  }
},
phone: "1-770-736-8031 x56442",
website: "hildegard.org",
company: {
  name: "Romaguera-Crona",
  catchPhrase: "Multi-layered client-server neural-net",
  bs: "harness real-time e-markets"
}
}
]]]></ee:set-payload>
        </ee:message>
    </ee:transform>
</flow>

<flow name="get:\users\userbyid:retrieve-users-api-config">
    <ee:transform doc:name="Transform Message">
        <ee:message>
            <ee:set-payload><![CDATA[%dw 2.0
output application/json
---
[
{
id: 3,
name: "Clementine Bauch",
username: "Samantha",
email: "Nathan@yesenia.net",
address: {
  street: "Douglas Extension",
  suite: "Suite 847",
  city: "McKenziehaven",
  zipcode: "59590-4157",
  geo: {
    lat: "-68.6102",
    lng: "-47.0653"
  }
},
phone: "1-463-123-4447",
website: "ramiro.info",
company: {
  name: "Romaguera-Jacobson",
  catchPhrase: "Face to face bifurcated interface",
  bs: "e-enable strategic applications"
}
}
]]]></ee:set-payload>
        </ee:message>
    </ee:transform>
</flow>
--

== Save your API Specification in Design Center

With your changes implemented, you can now save your API specification to Design Center:

. In Anypoint Code Builder, select your Source Control view.
. Select the plus icon next to `retrieve-users-api.raml`.
. Review the changes in the Source Control view. Note that the file has moved into *Staged Changes*.
. Click the plus icon in the section header to stage the remaining changes.
. Enter a message that summarizes the change or changes being made. For example: `_Create Retrieve Users API_`.
. Select *Push*.

Your changes are now published in Design Center.


== Publish the API Specification to Exchange

You can now publish your new API specification to Exchange to make it discoverable to other team members.

. Open the Command Palette by pressing Ctrl+Shift+P (Windows) or Cmd+Shift+P (Mac) and type _MuleSoft: Publish API Specification to Exchange_.
. Type a project name: +
* *Retrieve Users API*.
. Confirm the artifact ID: *Retrieve-Users-API*
. Confirm the asset version: *1.0.0*.
. Confirm the API version: *v1*.
+
The status bar shows the progress.

After the deployment completes, Code Builder updates your Mule project pom file to point to `v1.0.0` of your API specification.

To work iteratively on a new version of your API specification, close the current workspace and re-import version 1.0.0 of your API from Design Center, and implement it locally again.

== See Also

* xref:implement-local-api-specification.adoc[Implement a Local API Specification]
