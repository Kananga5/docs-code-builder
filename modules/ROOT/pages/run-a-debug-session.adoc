= Running a Debug Session

include::reuse::partial$beta-banner.adoc[tag="anypoint-code-builder"]

//LOGO (web, desktop, or both)
include::partial$acb-ide-logos.adoc[tags="both-ides"]

After setting up your debug conditions, you can run a debug session and evaluate your Mule application at each breakpoint.

== Before You Begin

Before you begin, ensure that:

* You designed an API specification. +
See xref:design-api-specification.adoc[].
* You developed an integration. +
See xref:develop-integration.adoc[].
* You implemented the API. +
See xref:implement-api-specification.adoc[].
* You added components to help your debug. +
See xref:debug-add-logger-set-variables.adoc[].
* You added breakpoints. +
See xref:debug-add-breakpoints.adoc[].
* Install a REST client like Postman or AdvancedRestClient.

[[debug]]
== Start a Debugging Session

. From the *Run and Debug* panel, click *Debug Mule Application*.
+
image::start-debugging.png[]
+
The IDE packages the application and opens a new terminal that deploys the application to the embedded Mule runtime engine:
+
image::packaged-and-running-terminals.png[]
. Proceed to <<test>>.

[[test]]
== Test Your Mule Application

. From a REST client or your browser, make a GET request to the running application to trigger the debugger. 
+
For guidance, see xref:ping-locally-deployed-app.adoc[].
//TODO: duke NEED TO MAKE flow-ref BREAKPOINT VISIBLE WHEN TRIGGERING APP
. In your American Flights project, notice that the execution of the application stops at your first breakpoint.
+
image::debug-stop-at-flow-ref.png[]
. Click the *Step Over* button on your debug toolbar to continue execution to next breakpoint.
. In the Debug sidebar, notice that the *Variables* panel provides information about the Mule event at the breakpoint.
+
image::debugger-stop-db-select.png[]
. Click the *Step Over* button on your debug toolbar to continue execution to your next breakpoint.
. In the Debug sidebar on the *Variables* panel, expand the *Mule Message* and the *Payload* variables and note that you can inspect the database response as an array.
+
image::debugger-stop-set-variable.png[]

== Add a Watch Expression

. Open the *Run and Debug* sidebar.
. From the *Watch* panel in the sidebar, select the `plus` icon, and add the expression `payload.^mediaType`.
+
image::debug-add-expression.png[]
. Select the *Step Over* button until your execution moves to the Set Payload component (`<set-payload/>`).
. Notice that your payload is `application/java`.
+
image:tut-debug-mediatype-java.png[]
. Select the *Step Over* button until execution continues to the Logger component (`<logger>`).
. Notice that your payload transforms to `application/json`.
+
image::tut-debug-mediatype-json.png[]
//image::debuger-watch-expression-json.png[]
. Select the *Continue* button on your debug toolbar, and notice  that the application returns the response from the database to your REST client or browser.
+
.Click for the complete implementation XML example.
[%collapsible]
====
[source,JSON]
--
[
    {
        "ID": 1,
        "code": "rree0001",
        "price": 541,
        "departureDate": "2016-01-20T00:00:00",
        "origin": "MUA",
        "destination": "LAX",
        "emptySeats": 0,
        "plane": {
            "type": "Boeing 787",
            "totalSeats": 200
        }
    },
    {
        "ID": 2,
        "code": "eefd0123",
        "price": 300,
        "departureDate": "2016-01-25T00:00:00",
        "origin": "MUA",
        "destination": "CLE",
        "emptySeats": 7,
        "plane": {
            "type": "Boeing 747",
            "totalSeats": 345
        }
    },
    {
        "ID": 3,
        "code": "ffee0192",
        "price": 300,
        "departureDate": "2016-01-20T00:00:00",
        "origin": "MUA",
        "destination": "LAX",
        "emptySeats": 0,
        "plane": {
            "type": "Boeing 777",
            "totalSeats": 300
        }
    },
    {
        "ID": 4,
        "code": "rree1000",
        "price": 200,
        "departureDate": "2016-01-20T00:00:00",
        "origin": "MUA",
        "destination": "CLE",
        "emptySeats": 5,
        "plane": {
            "type": "Boeing 737",
            "totalSeats": 150
        }
    },
    {
        "ID": 5,
        "code": "rree1093",
        "price": 142,
        "departureDate": "2016-02-11T00:00:00",
        "origin": "MUA",
        "destination": "SFO",
        "emptySeats": 1,
        "plane": {
            "type": "Boeing 737",
            "totalSeats": 150
        }
    },
    {
        "ID": 6,
        "code": "ffee1112",
        "price": 954,
        "departureDate": "2016-01-20T00:00:00",
        "origin": "MUA",
        "destination": "CLE",
        "emptySeats": 100,
        "plane": {
            "type": "Boeing 787",
            "totalSeats": 200
        }
    },
    {
        "ID": 7,
        "code": "eefd1994",
        "price": 676,
        "departureDate": "2016-01-01T00:00:00",
        "origin": "MUA",
        "destination": "SFO",
        "emptySeats": 0,
        "plane": {
            "type": "Boeing 777",
            "totalSeats": 300
        }
    },
    {
        "ID": 8,
        "code": "ffee2000",
        "price": 300,
        "departureDate": "2016-02-20T00:00:00",
        "origin": "MUA",
        "destination": "SFO",
        "emptySeats": 30,
        "plane": {
            "type": "Boeing 737",
            "totalSeats": 150
        }
    },
    {
        "ID": 9,
        "code": "eefd3000",
        "price": 900,
        "departureDate": "2016-02-01T00:00:00",
        "origin": "MUA",
        "destination": "SFO",
        "emptySeats": 0,
        "plane": {
            "type": "Boeing 737",
            "totalSeats": 150
        }
    },
    {
        "ID": 10,
        "code": "eefd4511",
        "price": 900,
        "departureDate": "2016-01-15T00:00:00",
        "origin": "MUA",
        "destination": "LAX",
        "emptySeats": 100,
        "plane": {
            "type": "Boeing 777",
            "totalSeats": 300
        }
    },
    {
        "ID": 11,
        "code": "rree4567",
        "price": 456,
        "departureDate": "2016-01-20T00:00:00",
        "origin": "MUA",
        "destination": "SFO",
        "emptySeats": 100,
        "plane": {
            "type": "Boeing 737",
            "totalSeats": 150
        }
    }
]
--
. Proceed to <<stop>>.
====

[[stop]]
== Stop the Debugging Session

To stop your debugging session: 

. Select the *Stop* button on your debug toolbar.
+
image::debugger-stop.png[]
. Proceed to xref:deploy-mule-application.adoc[Deploy a Mule Application]
