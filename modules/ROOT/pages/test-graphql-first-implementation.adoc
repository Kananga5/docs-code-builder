= Test Your GraphQL Implementation
:imagesdir: ../assets/images

include::reuse::partial$beta-banner.adoc[tag="anypoint-code-builder"]

//LOGO (web, desktop, or both)
include::partial$acb-ide-logos.adoc[tags="both-ides"]

With a scaffolded project, run your application locally and test the endpoints of your Mule application.

Note that because the GraphQL schema does not allow examples, Anypoint Code Builder scaffolds an empty project, so in this first run, your responses are empty.

== Before You Begin

Before you begin, ensure that you:

* Set up your MuleSoft environment. +
See xref:setup.adoc[] for more information.
* Download the xref:attachment$books-api.graphql[*Books API* GraphQL schema].
* Implement the Books API GraphQL Schema. +
See xref:implement-a-graphql-api.adoc[Implement a GraphQL API].
* Install a REST client like Postman or AdvancedRestClient.

== Run Your Application

To locally deploy your Mule Application, run a debug session in Anypoint Code Builder:

. Launch Anypoint Code Builder.
. Open the *Books Implementation* project.
. Select Run and Debug in the Activity Bar, then press the *Start Debugging* icon.
+
// TODO: cc: desktop IDE UI differs
// image::start-debugging.png[]

// TODO: cc: these steps are all web-IDE specific. What are the corresponding desktop IDE steps? I think these desktop steps will need to come from engineering, as I'm not sure I'll have the time to figure it all out. However, initial tests show that the test URL on desktop is localhost, not the web IDE instance address. But what are the remaining steps? Does the GraphQL query differ?
. Launch your browser Developer Tools (`F12`).
. Navigate to your *Application* tab, under *Storage* expanded the *Cookies* section, and select the URL of your web IDE instance.
+
image::application-storage-cookies.png[]
. Copy the cookie name and value. For example:
+
[source]
--
proxysession5f5648c7115f4e2e8f3f9396355ac4e8-0=xxxxxxxxxxxxxx
--
+
[NOTE]
--
The `proxysession` cookie name varies depending on the user.
--
. In Anypoint Code Builder, navigate to *View* > *Appearance* > *Panel*.
+
Alternatively, press Ctrl+j (Windows) or Cmd+j (Mac).
. Navigate to the *Ports* tab.
. Copy the local address for port `8081`:
+
image::ports-panel-local-address-8081.png[]
+
[NOTE]
--
The URL to ping varies depending on the webIDE instance ID. It follows the format `+https://<web-IDE-instance>/proxy/<port-you-configured-on-your-listener>/+`. In this case, because you are pinging the 8081 port, your URL is `+https://<web-IDE-instance>/proxy/8081/+`.
See xref:ping-locally-deployed-app.adoc[] for more information.
--
. In your preferred REST client, create a `POST` request to the local address, adding the `/graphql` path: `+https://<web-IDE-instance>/proxy/8081/graphql+`.
. Add a new *Cookie* header to the request with the `proxysession` value:
+
[source,CURL]
--
--header 'Cookie: proxysession5f5648c7115f4e2e8f3f9396355ac4e8-0=xxxxxxxxxxxxxx \
--
+
// TODO: cc: We probably shouldn't have screenshots of third-party applications, due to maintenance issues.
// image::send-request-with-cookies.png[]
. Configure the body of the request to contain a GraphQL query. For example:
+
[source,GraphQL]
--
query bookById($id: ID){
	bookById(id: $id) {
		id
		name
		pageCount
		author{
			id
			firstName
			lastName
		}
	}
}
--
+
Note that because you are querying a value by a specific ID (`$id: ID`), you must provide a GraphQL variable with the ID you want to query:
+
[source,GraphQL]
--
{
	"id": 1
}
--
+
// TODO: cc: We probably shouldn't have screenshots of third-party applications, due to maintenance issues.
// image::graphql-query-book-by-id.png[]
. Send the request.
. Anypoint Code Builder returns an empty field for the book:
+
[source,GraphQL]
--
{
    "data": {
        "bookById": null
    }
}
--

Other queries you can try for your endpoint are:

* Query `books`:
+
[source,GraphQL]
--
query books {
	books{
		id
		name
		pageCount
		author{
			id
			firstName
			lastName
		}
	}
}
--
* Query `bestSellers`
+
[source,GraphQL]
--
query bestsellers {
	bestsellers{
		books{
			id
			name
			pageCount
			author{
				id
				firstName
				lastName
			}
		}
		authors{
			id
			firstName
			lastName
		}
	}
}
--

All these requests will return an empty result.

== Next Step

* xref:configure-graphql-flow-responses.adoc[Configure Responses for Your GraphQL Implementation]. +
Populate each flow with a custom response for each query.
