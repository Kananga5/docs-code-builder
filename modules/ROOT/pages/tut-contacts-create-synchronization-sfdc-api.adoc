= Create a Contacts Synchronization API with Salesforce
:page-aliases: create-synchronization-sfdc-api.adoc

include::reuse::partial$beta-banner.adoc[tag="anypoint-code-builder"]

//LOGO (web, desktop, or both)
include::partial$acb-ide-logos.adoc[tags="both-ides"]

Create an API specification that synchronizes your contacts database with Salesforce.

The synchronization API that you build contains a flow with the following logic:

* Fetch a contact from Salesforce.
* If the contact in Salesforce has a phone number, retrieve its first and last name.
* Define if the contact exists in the database by matching its first and last name with the contact fetched from Salesforce.
* If the contact in the database matches the contact on Salesforce, update the phone number in the Database and return a response indicating success.
* Otherwise, create a response indicating that the contact doesnâ€™t exist.

== Before You Begin

Before you begin, ensure that you:

* Set up your MuleSoft environment. +
See xref:setup.adoc[] for more information.
* Set up a Salesforce demo environment.
** Sign up for a developer organization https://developer.salesforce.com/signup[here^].
** Create a developer security token https://help.salesforce.com/s/articleView?id=sf.user_security_token.htm&type=5[here^].
* Create a MySQL Database instance using AWS free tier following the steps https://aws.amazon.com/getting-started/hands-on/create-mysql-db/[here^].

== Create the API Specification

. In the cloud IDE instance, navigate to your Anypoint Code Builder view:
+
image::anypoint-code-builder-view.png[]
. Select *Design an API*.
+
image::design-api-1.png[]
+
. Configure the API using the following values:
+
image::design-api-ui-raml.png[]
+
[calloutlist]
.. Under *Project name* type: `*Contact Sync*`.
.. Under *Project Location* select *Browse*, and then select your home directory.
.. Under *API Specification Language* select *RAML 1.0*.
.. Under *Business Group* select the business group in which you want to create your API specification.
+
. Select *Create Project*.

The project explorer now shows you the American Flights API folder with a `contact-sync.raml` file open in the editor.

. Select `contact-sync.raml` from the Explorer view:
+
image::select-contact-sync.png[]
. Paste the following RAML description to the API specification:
+
[source,RAML]
--
#%RAML 1.0
title: Contact Sync

mediaType:
- application/json
version: 1.0
protocols:
 - http
 - https
/updatePhone:
   post:
       queryParameters:
         phoneNumber:
           type: number
           example: 5555555555
           required: true
         firstName:
           type: string
           example: Anna
           required: true
         lastName:
           type: string
           example: Woods
           required: true
       displayName: update
       responses:
           200:
             body:
               type: string
               example: Successfully updated!
--
. Select the *API Console* icon to review the API:
+
image::select-api-console-contact-sync.png[]
. Review the newly created `/post` endpoint.
+
image::update-phone-endpoint.png[]

== Save Your Changes to Design Center

To enable collaboration on this API specification:

. In Anypoint Code Builder, select the Source Control view.
+
image::contact-sync-select-vcs.png[]
. Select the *Stage Changes* icon next to the `contact-sync.raml` file.
+
image::contact-sync-stage-changes.png[]
. Type a commit message, for example, _Initial Commit_, and select *Commit*.
+
image::contact-sync-initial-commit.png[]
. Select the menu icon, and select *Push*.
+
image::contact-sync-push-changes.png[]


== Publish Your API to Exchange and Scaffold it

To write the logic behind this API, you must publish it to Exchange:

. In Anypoint Code Builder, open the `american-flights-api.raml` file.
. Open the Command Palette by pressing Ctrl+Shift+P (Windows) or Cmd+Shift+P (Mac), and provide the following command:
+
[source,command]
----
MuleSoft: Publish API Specification to Exchange
----
+
image::publish-to-exchange.png[]
. Type a project name: +
* *Contact Sync*
. Confirm the asset version: *1.0.0*.
+
image::set-asset-version.png[]
. Confirm the API version: *v1*.
+
image::set-api-version.png[]
+
The status bar shows the progress.
+
image::publishing-to-exchange-dialog.png[]
. Select *Yes* when prompted to scaffold the API dependency.
+
image::scaffold-option-yes.png[]
+
. Select a name for the project:
* *contact-sync*
+
. Select a directory where you want to create the project.
+
image::select-project-location.png[]

Anypoint Code Builder adds the API specification as a dependency in the `pom.xml` file of your project and creates a new file called `contact-sync.xml`:

image::contact-sync-outline.png[]

== Next Step

* xref:tut-contacts-create-config-files.adoc[]. +
Learn how to create configuration files for your different connectors.
