= Work with Code Snippets

//LOGO (web, desktop, or both)
include::partial$acb-ide-logos.adoc[tags="both-ides"]

//TODO: IS THS UP-TO-DATE?
//TODO: CAN'T SEE IMAGES

To reuse code patterns in configuration files for your Mule applications, use built-in snippets or define your own user snippets. This practice avoids the need to retype the same pattern each time you use it, which helps you work more quickly and reduces the potential for configuration errors. Use snippets to provide configurations for any elements supported by the Mule DSL, such as commonly used connector operations, processing patterns performed by other components, or multi-element configurations in the configuration XML.

Snippets are templates created in the JSON format. When you insert a snippet into the configuration XML for a Mule application, the snippet JSON transforms to XML automatically. Create user snippets in the `mule-xml.json`.

//TODO: WHAT DOES THIS MEAN?? 
Anypoint Code Builder does not filter out snippets for code that goes outside a flow, such as connector configurations.

== Built-In Snippets

Code Builder bundles a set of built-in snippets. To add a built-in snippet to your flow:

. Select the `plus` icon on your canvas to add a new component to your flow.
. Select _Snippets_:
+
//TODO: IMAGE OUT OF DATE AND ALMOST IMPOSSIBLE TO MAKE OUT
image::select-snippet-overview.png[]
. Select _Built-in Snippets_:
+
//TODO: IMAGE OUT OF DATE AND ALMOST IMPOSSIBLE TO MAKE OUT 
image::built-in-snippets-overview.png[]
. Choose the snippet you want from the list of provided snippets.

Use the auto-complete feature when working on the XML editor to find any of the built-in snippets.

== Create a Snippet

Create and save reusable custom snippets to use in your project.

The snippets that you save are specific to your IDE instance and not shared when you export your project for others to import and work on.

To create a snippet:

. Select the `plus` icon on your canvas to add a new component to your flow.
. Select _Snippets_:
+
//TODO: IMAGE OUT OF DATE AND ALMOST IMPOSSIBLE TO MAKE OUT
image::select-snippet-overview.png[]
. Select _User Snippets_:
+
//TODO: IMAGE OUT OF DATE AND ALMOST IMPOSSIBLE TO MAKE OUT
image::user-snippet-overview.png[]
. Select the `plus` icon:
+
//TODO: IMAGE OUT OF DATE AND ALMOST IMPOSSIBLE TO MAKE OUT
image::create-user-snippet-overview.png[]
+
If there is no snippet for a configuration you require, you can create one from the UI. If you have no snippets, Anypoint Code Builder creates a new `mule-xml.json` snippet file with a sample snippet for you to edit.
. In the sample snippet file (`mule-xml.json`) that Anypoint Code Builder creates, uncomment all the fields after *Example*:
+
[source,JSON]
--
{
    // Example:
	  "Log a message": { //<!--<1>-->
	 	"prefix": "log", //<!--<2>-->
	 	"body": [ //<!--<3>-->
	 		"<logger level=\"${1:INFO}\" message='$2' doc:name=\"Logger\" doc:id=\"$RANDOM_HEX\" />$0",
	 	],
	 	"description": "Log output to console" //<!--<4>-->
	 }
}
--
<1> The first element in the XML is the text that displays in the list of user snippets.
<2> The `prefix` field is the trigger text for that snippet. Start typing the prefix and press `tab` in your XML editor to add the snippet using auto-complete.
<3> The `body` field is the actual code template that you can reuse.
<4> The `description` field is a description of the snippet.
+
After you save the new snippet, select the new snippet from the canvas to load the configuration XML for your application, the XML for the logger example looks like this:
+
[source,xml]
----
<logger level="" message='$2' doc:name="Logger" doc:id="sgxbfo" />
----
+
In this example, notice that `doc:id` is a randomly generated because of the `$RANDOM_HEX` value in the snippet.
+
. Add any required values or configurations to the XML.
+
In the example, the next step is to add a `level` and `message` value to the component. For example:
+
[source,xml]
----
<logger level="WARN" message='my message here' doc:name="Logger" doc:id="sgxbfo" />
----
. Add any other snippets to your `mule-xml.json` by adding new fields. For example:
+
[source,JSON]
--
{
    // Example:
	 "Log a message": {
	 	"prefix": "log",
	 	"body": [
	 		"<logger level=\"${1:INFO}\" message='$2' doc:name=\"Logger\" doc:id=\"$RANDOM_HEX\" />$0",
	 	],
	 	"description": "Log output to console"
	 },
        "Select first and last name from database": { //<!--<1>-->
          "prefix": "select-name-from-db",
          "body": [
            "<db:select config-ref=\"${1:Database_Config}\" doc:name=\"${2:Select Contact from DB}\" doc:id=\"$RANDOM_HEX\" >",
            "<db:sql>",
            "<![CDATA[SELECT * FROM Contacts WHERE FirstName = :firstname AND LastName = :lastname]]>",
            "</db:sql>",
            "<db:input-parameters>",
              "<![CDATA[#[\\{",
              "firstname: vars.firstnameVar,",
              "lastname: vars.lastnameVar",
              "\\}]]]>",
            "</db:input-parameters>",
            "</db:select>$0"
		],
		"description": "Pull first and last name from database"
	 }
}
--
<1> A snippet for a Database Connector select operation that retrieves `firstName` and `lastName` values from a Database.
+
If you insert the snippet the database example into your configuration XML, the next step is to provide the value of `config-ref=""`. To get the value, it is necessary to configure a global `<db:config/>` element at outside of the `<flow/>`. To learn more about this configuration, see xref:connect-to-a-db.adoc[].